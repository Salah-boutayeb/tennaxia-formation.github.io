import{_ as A,D as B,B as M,i as $,r as _,a as d,o as h,c as b,d as a,w as s,b as l,t as v,l as L,g as P,m as H,F as G,p as K,h as O,e as Y}from"./index.c68dd7c5.js";/* empty css                                                                     */const f=m=>(K("data-v-ff4afae5"),m=m(),O(),m),j=f(()=>l("h5",null,"Factures",-1)),q={class:"card p-fluid"},z=["href"],J={class:"field"},Q=f(()=>l("label",{class:"mb-3"},"N\xB0 facture",-1)),W={class:"field"},X=f(()=>l("label",{class:"mb-3"},"Montant HT",-1)),Z={class:"field"},ee=f(()=>l("h5",null,"Ech\xE9ance",-1)),te={class:"field"},ae=f(()=>l("label",{class:"mb-3"},"Documents de facture",-1)),ne={__name:"FactureTable",setup(m){const r=B(),y=M(()=>r.state.factures);$(()=>{r.dispatch("allFactures"),r.commit("INIT_PROCESS")}),_(!1);const w=_(!1),n=_({}),S=_([{label:"re\xE7u",value:"RECU"},{label:"valid\xE9e",value:"VALIDEE"},{label:"\xE0 r\xE9gler",value:"AREGLER"},{label:"pay\xE9e",value:"PAYEE"},{label:"retard",value:"RETARD"}]),g=_([]),E=o=>{let{newData:t,index:V}=o;const u=new FormData;u.append("_method","PUT"),u.append("num_facture",t.num_facture),u.append("montant_ht",t.montant_ht),u.append("montant_ttc",t.montant_ht*1.2),u.append("facture",n.value.facture),u.append("facture_id",t.documents[0].id),console.log("montant_ht",t.montant_ht,"montant_ttc",t.montant_ht*1.2),r.dispatch("updateFacture",{facture:u,factureId:t.id}),n.value={}},I=o=>new Intl.NumberFormat("en-US",{style:"currency",currency:"MAD"}).format(o),U=()=>{const o=new FormData;n.value.mission_id=r.state.selectedDemande.mission.id,o.append("num_facture",n.value.num_facture),o.append("echeance",n.value.echeance.label),o.append("montant",n.value.montant),o.append("mission_id",n.value.mission_id),o.append("facture",n.value.facture),console.log(n.value),r.dispatch("saveFacture",o),n.value={}},D=o=>{n.value.facture=o[0]};return(o,t)=>{const V=d("Toast"),u=d("Toolbar"),T=d("InputText"),c=d("Column"),F=d("InputNumber"),x=d("Tag"),R=d("DataTable"),N=d("Dropdown"),C=d("Button"),k=d("Dialog");return h(),b(G,null,[j,a(V),a(u,{class:"mb-4"},{end:s(()=>[]),_:1}),l("div",q,[a(R,{editingRows:g.value,"onUpdate:editingRows":t[1]||(t[1]=e=>g.value=e),value:H(y),paginator:"",scrollable:!0,rows:4,editMode:"row",dataKey:"id",onRowEditSave:E,tableClass:"editable-cells-table"},{default:s(()=>[a(c,{field:"num_facture",header:"Num\xB0 facture",style:{width:"20%"}},{editor:s(({data:e,field:i})=>[a(T,{modelValue:e[i],"onUpdate:modelValue":p=>e[i]=p},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(c,{field:"client",header:"client",style:{width:"20%"}},{body:s(({data:e})=>[l("span",null,v(`${e.mission.client.entite}`),1)]),_:1}),a(c,{field:"agent",header:"agent",style:{width:"20%"}},{body:s(({data:e})=>[l("span",null,v(`${e.mission.client.nom} ${e.mission.client.prenom} `),1)]),_:1}),a(c,{field:"montant_ht",header:"montant HT",style:{width:"30%"}},{body:s(({data:e,field:i})=>[L(v(I(e[i])),1)]),editor:s(({data:e,field:i})=>[a(F,{modelValue:e[i],"onUpdate:modelValue":p=>e[i]=p,mode:"currency",currency:"MAD",locale:"en-US"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(c,{field:"type",header:"type",style:{width:"30%"}},{body:s(e=>[a(x,{value:e.data.type,severity:"info"},null,8,["value"])]),_:1}),a(c,{field:"documents",header:"facture",style:{width:"30%"}},{editor:s(({data:e,field:i})=>[o.convention?P("",!0):(h(),b("input",{key:0,type:"file",name:"convention",id:"convention",onChange:t[0]||(t[0]=p=>D(p.target.files))},null,32))]),body:s(e=>[l("a",{href:e.data.documents[0].filepath,class:""},v(e.data.documents[0].filename),9,z)]),_:1}),a(c,{rowEditor:!0,style:{width:"5%","min-width":"0.5rem"},bodyStyle:"text-align:center"}),a(c,{style:{width:"0.1rem"},bodyStyle:"text-align:center"},{body:s(e=>[]),_:1})]),_:1},8,["editingRows","value"]),a(k,{visible:w.value,"onUpdate:visible":t[6]||(t[6]=e=>w.value=e),style:{width:"450px"},header:"Facture",modal:!0,class:"p-fluid"},{footer:s(()=>[a(C,{label:"Cancel",icon:"pi pi-times",class:"p-button-text",onClick:o.hideDialog},null,8,["onClick"]),a(C,{label:"Save",icon:"pi pi-check",class:"p-button-text",onClick:U})]),default:s(()=>[l("div",J,[Q,a(T,{modelValue:n.value.num_facture,"onUpdate:modelValue":t[2]||(t[2]=e=>n.value.num_facture=e)},null,8,["modelValue"])]),l("div",W,[X,a(F,{modelValue:n.value.montant_ht,"onUpdate:modelValue":t[3]||(t[3]=e=>n.value.montant_ht=e),inputId:"currency-us",mode:"currency",currency:"MAD"},null,8,["modelValue"])]),l("div",Z,[ee,a(N,{modelValue:n.value.echeance,"onUpdate:modelValue":t[4]||(t[4]=e=>n.value.echeance=e),options:S.value,optionLabel:"label",placeholder:"Select"},null,8,["modelValue","options"])]),l("div",te,[ae,l("input",{type:"file",name:"contrat",id:"contart",onChange:t[5]||(t[5]=e=>D(e.target.files))},null,32)])]),_:1},8,["visible"])])],64)}}},oe=A(ne,[["__scopeId","data-v-ff4afae5"]]),le={class:"card"},ue={__name:"Facture",setup(m){return Y(()=>{}),(r,y)=>(h(),b("div",le,[a(oe)]))}};export{ue as default};
