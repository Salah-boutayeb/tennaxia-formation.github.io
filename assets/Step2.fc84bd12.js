import{_ as ae,D as oe,E as le,q as ie,u as se,B as ne,r,i as de,e as ue,j as re,a as u,o as p,c as b,b as o,d as i,w as n,m as T,l as m,t as h,y as U,g as v,n as q,p as pe,h as ce}from"./index.c68dd7c5.js";import{T as _}from"./TimeFormater.7fba339f.js";const s=w=>(pe("data-v-baa0b97e"),w=w(),ce(),w),me={class:"grid"},ve={class:"col-12"},_e={class:"card"},fe={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},be=s(()=>o("h5",{class:"m-0"},"Manage propositions",-1)),he={class:"block mt-2 md:mt-0 p-input-icon-left"},ye=s(()=>o("i",{class:"pi pi-search"},null,-1)),ge=s(()=>o("span",{class:"p-column-title"},"id",-1)),xe=s(()=>o("span",{class:"p-column-title"},"entite",-1)),we=s(()=>o("span",{class:"p-column-title"},"Date debut",-1)),ke=s(()=>o("span",{class:"p-column-title"},"Date fin",-1)),De=s(()=>o("span",{class:"p-column-title"},"duree",-1)),Ce=s(()=>o("span",{class:"p-column-title"},"prix",-1)),Ve={class:"field"},Se=s(()=>o("label",{for:"entite"},"Intitule",-1)),Pe={key:0,class:"p-invalid"},Te={class:"field"},Ie=s(()=>o("label",{for:"description"},"D\xE9tails de la proposition",-1)),Ne={class:"field"},Be={class:"field"},Ue=s(()=>o("label",{for:"description"},"Date de debut",-1)),qe={class:"field"},Le=s(()=>o("label",{class:"mb-3"},"Date de fin",-1)),Fe={class:"formgrid grid"},Me={class:"field col"},Oe=s(()=>o("label",{for:"prix"},"prix",-1)),Re={key:0,class:"p-invalid"},$e={key:0,class:"formgrid grid"},je={class:"field col"},ze=s(()=>o("label",{class:"mb-12"},"Offre commercial: ",-1)),Ye={class:"mb-12"},Ae={key:1,class:"formgrid grid"},Ee={class:"field col"},Ke=s(()=>o("label",{class:"mb-12"},"Offre technique: ",-1)),Ge={class:"mb-12"},He={class:"flex align-items-center justify-content-center"},Je=s(()=>o("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),Qe={key:0},We={class:"flex align-items-center justify-content-center"},Xe=s(()=>o("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),Ze={key:0},et=s(()=>o("div",{class:"card"},null,-1)),tt={__name:"Step2",setup(w){const f=oe(),L=le(),k=ie();se();const S=ne(()=>f.getters.getPropositions),y=r(!1),x=r(!1),D=r(!1),e=r(),C=r(null),F=r(null),V=r({}),g=r(!1);de(()=>{A()}),ue(()=>{});const M=r([{name:"intra",code:"NY"},{name:"inter",code:"RM"},{name:"visio",code:"LDN"},{name:"conference",code:"IST"}]),O=()=>{e.value={},g.value=!1,y.value=!0},R=()=>{y.value=!1,g.value=!1},$=a=>{e.value={...a},e.value.prix=Number(a.prix),e.value.date_debut=_.formatDate(e.value.date_debut),e.value.date_fin=_.formatDate(e.value.date_fin),y.value=!0},j=a=>{e.value=a,x.value=!0},z=()=>{f.dispatch("deleteProposition",{propositionId:e.value.id}).then(a=>{k.add({severity:"success",summary:"Successful",detail:a,life:3e3})}).catch(()=>{}),x.value=!1,e.value={}},Y=()=>{S.value=S.value.filter(a=>!C.value.includes(a)),D.value=!1,C.value=null,k.add({severity:"success",summary:"Successful",detail:"propositions Deleted",life:3e3})},A=()=>{V.value={global:{value:null,matchMode:re.CONTAINS}}},E=a=>{e.value.offre_commercial=a[0]},K=a=>{e.value.offre_technique=a[0]},G=()=>{const a=new FormData;e.value.demande_id=f.state.selectedDemande.id,e.value.gestionnaire_id=f.state.user.user.id,a.append("intitule",e.value.intitule),a.append("date_debut",_.formatDate1(e.value.date_debut)),a.append("date_fin",_.formatDate1(e.value.date_fin)),a.append("gestionnaire_id",e.value.gestionnaire_id),a.append("format",e.value.format.name),a.append("details",e.value.details),a.append("demande_id",e.value.demande_id),a.append("prix",e.value.prix),a.append("offre_commercial",e.value.offre_commercial),a.append("offre_technique",e.value.offre_technique),f.dispatch("saveProposition",a).then(l=>{k.add({severity:"success",summary:"Successful",detail:l,life:3e3})}).catch(l=>{}),e.value={},y.value=!1},H=()=>{e.value.format=typeof e.value.format=="string"?e.value.format:e.value.format.name;const a=new FormData;a.append("intitule",e.value.intitule),a.append("date_debut",_.formatDate1(e.value.date_debut)),a.append("date_fin",_.formatDate1(e.value.date_fin)),a.append("gestionnaire_id",e.value.gestionnaire_id),a.append("format",e.value.format),a.append("details",e.value.details),a.append("demande_id",e.value.demande_id),a.append("prix",e.value.prix),a.append("_method","PUT"),f.dispatch("updateProposition",{propositionId:e.value.id,proposition:a}).then(l=>{k.add({severity:"success",summary:"Successful",detail:l,life:3e3})}).catch(l=>{})},J=a=>{f.dispatch("getPropsitionById",a.id),L.push("/step3")};return(a,l)=>{const Q=u("Toast"),d=u("Button"),W=u("Toolbar"),I=u("InputText"),c=u("Column"),X=u("DataTable"),Z=u("Textarea"),ee=u("Dropdown"),N=u("Calendar"),te=u("InputNumber"),P=u("Dialog");return p(),b("div",me,[o("div",ve,[o("div",_e,[i(Q),i(W,{class:"mb-4"},{end:n(()=>[i(d,{label:"New",icon:"pi pi-plus",class:"p-button-success mr-2",onClick:O})]),_:1}),i(X,{ref_key:"dt",ref:F,value:T(S),selection:C.value,"onUpdate:selection":l[1]||(l[1]=t=>C.value=t),dataKey:"id",paginator:!0,rows:10,filters:V.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} propositions",responsiveLayout:"scroll"},{header:n(()=>[o("div",fe,[be,o("span",he,[ye,i(I,{modelValue:V.value.global.value,"onUpdate:modelValue":l[0]||(l[0]=t=>V.value.global.value=t),placeholder:"Search..."},null,8,["modelValue"])])])]),default:n(()=>[i(c,{selectionMode:"multiple",headerStyle:"width: 3rem"}),i(c,{field:"id",header:"id",sortable:!0,headerStyle:"width:10%; min-width:10rem;"},{body:n(t=>[ge,m(" "+h(t.data.id),1)]),_:1}),i(c,{field:"entite",header:"entite",sortable:!0,headerStyle:"width:20%; min-width:10rem;"},{body:n(t=>[xe,m(" "+h(t.data.demande.client.nom+" "+t.data.demande.client.prenom+" ("+t.data.demande.client.entite+")"),1)]),_:1}),i(c,{field:"date_debut",header:"Date debut",sortable:!0,headerStyle:"width:30%; min-width:10rem;"},{body:n(t=>[we,m(" "+h(T(_).formatDate1(t.data.date_debut)),1)]),_:1}),i(c,{field:"date_fin",header:"Date fin",sortable:!0,headerStyle:"width:30%; min-width:10rem;"},{body:n(t=>[ke,m(" "+h(T(_).formatDate1(t.data.date_fin)),1)]),_:1}),i(c,{field:"duree",header:"duree",sortable:!0,headerStyle:"width:10%; min-width:10rem;"},{body:n(t=>[De,m(" "+h(t.data.demande.duree),1)]),_:1}),i(c,{field:"prix",header:"prix",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:n(t=>[Ce,m(" "+h(t.data.prix),1)]),_:1}),i(c,{headerStyle:"min-width:10rem;"},{body:n(t=>[i(d,{icon:"pi pi-pencil",class:"p-button-rounded p-button-success mr-2",onClick:B=>$(t.data)},null,8,["onClick"]),i(d,{icon:"pi pi-eye",class:"p-button-rounded p-button-info mr-2",onClick:B=>J(t.data)},null,8,["onClick"]),i(d,{icon:"pi pi-trash",class:"p-button-rounded p-button-warning mt-2",onClick:B=>j(t.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","selection","filters"]),i(P,{visible:y.value,"onUpdate:visible":l[10]||(l[10]=t=>y.value=t),style:{width:"450px"},header:"Proposition",modal:!0,class:"p-fluid"},{footer:n(()=>[i(d,{label:"Cancel",icon:"pi pi-times",class:"p-button-text",onClick:R}),e.value.id?v("",!0):(p(),U(d,{key:0,label:"Save",icon:"pi pi-check",class:"p-button-text",onClick:G})),e.value.id?(p(),U(d,{key:1,label:"Update",icon:"pi pi-check",class:"p-button-text",onClick:H})):v("",!0)]),default:n(()=>[o("div",Ve,[Se,i(I,{id:"entite",modelValue:e.value.intitule,"onUpdate:modelValue":l[2]||(l[2]=t=>e.value.intitule=t),modelModifiers:{trim:!0},required:"true",autofocus:"",class:q({"p-invalid":g.value&&!e.value.intitule})},null,8,["modelValue","class"]),g.value&&!e.value.intitule?(p(),b("small",Pe,"entite is required.")):v("",!0)]),o("div",Te,[Ie,i(Z,{id:"description",modelValue:e.value.details,"onUpdate:modelValue":l[3]||(l[3]=t=>e.value.details=t),required:"true",rows:"3",cols:"20"},null,8,["modelValue"])]),o("div",Ne,[i(ee,{modelValue:e.value.format,"onUpdate:modelValue":l[4]||(l[4]=t=>e.value.format=t),options:M.value,optionLabel:"name",placeholder:"Format"},null,8,["modelValue","options"])]),o("div",Be,[Ue,i(N,{showIcon:!0,modelValue:e.value.date_debut,"onUpdate:modelValue":l[5]||(l[5]=t=>e.value.date_debut=t),showButtonBar:!0},null,8,["modelValue"])]),o("div",qe,[Le,i(N,{showIcon:!0,modelValue:e.value.date_fin,"onUpdate:modelValue":l[6]||(l[6]=t=>e.value.date_fin=t),showButtonBar:!0},null,8,["modelValue"])]),o("div",Fe,[o("div",Me,[Oe,i(te,{id:"prix",modelValue:e.value.prix,"onUpdate:modelValue":l[7]||(l[7]=t=>e.value.prix=t),class:q({"p-invalid":g.value&&!e.value.prix}),required:!0},null,8,["modelValue","class"]),g.value&&!e.value.prix?(p(),b("small",Re,"prix is required.")):v("",!0)])]),e.value.id?v("",!0):(p(),b("div",$e,[o("div",je,[ze,o("div",Ye,[o("input",{class:"",type:"file",name:"contrat",onChange:l[8]||(l[8]=t=>E(t.target.files)),id:""},null,32)])])])),e.value.id?v("",!0):(p(),b("div",Ae,[o("div",Ee,[Ke,o("div",Ge,[o("input",{class:"",type:"file",name:"contrat",onChange:l[9]||(l[9]=t=>K(t.target.files)),id:""},null,32)])])]))]),_:1},8,["visible"]),i(P,{visible:x.value,"onUpdate:visible":l[12]||(l[12]=t=>x.value=t),style:{width:"450px"},header:"Confirm",modal:!0},{footer:n(()=>[i(d,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:l[11]||(l[11]=t=>x.value=!1)}),i(d,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:z})]),default:n(()=>[o("div",He,[Je,e.value?(p(),b("span",Qe,[m("Vous \xEAtes sur, vous voulez supprimer la proposition: "),o("b",null,h(e.value.intitule),1),m("?")])):v("",!0)])]),_:1},8,["visible"]),i(P,{visible:D.value,"onUpdate:visible":l[14]||(l[14]=t=>D.value=t),style:{width:"450px"},header:"Confirm",modal:!0},{footer:n(()=>[i(d,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:l[13]||(l[13]=t=>D.value=!1)}),i(d,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:Y})]),default:n(()=>[o("div",We,[Xe,a.product?(p(),b("span",Ze,"Are you sure you want to delete the selected propositions?")):v("",!0)])]),_:1},8,["visible"])]),et])])}}},lt=ae(tt,[["__scopeId","data-v-baa0b97e"]]);export{lt as default};
